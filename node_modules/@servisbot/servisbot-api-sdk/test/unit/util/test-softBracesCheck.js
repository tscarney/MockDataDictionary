const sinon = require('sinon');
const assert = require('assert');
const softBracesCheck = require('../../../src/Maker/util/softBracesCheck');

/* eslint-disable no-console, no-template-curly-in-string */

describe('Unit: Soft Braces Check', () => {
  beforeEach(() => {
    sinon.spy(console, 'log');
  });
  afterEach(() => {
    console.log.restore();
  });

  it('Should log out a warning for soft brace', async () => {
    const testObject = {
      item1: 'Check out this {name}',
      item2: 'Check out this ${name}'
    };
    await softBracesCheck(testObject);
    assert(console.log.calledOnce);
  });

  it('Should find any soft brace', async () => {
    const testObject = {
      item1: 'Check out this ${name}',
      item2: 'Check out this ${name}'
    };
    await softBracesCheck(testObject);
    assert(console.log.notCalled);
  });
  it('Should log out a warning for soft brace, on deeply nested object', async () => {
    const testObject = {
      item1: 'Check out this ${name}',
      item2: 'Check out this ${name}',
      one: {
        two: {
          three: {
            four: {
              five: {
                six: {
                  seven: {
                    eight: {
                      nine: {
                        ten: {
                          here: 'check this out {name}'
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    };
    await softBracesCheck(testObject);
    assert(console.log.calledOnce);
  });

  it('Should log out two warning for two soft braces in same string', async () => {
    const testObject = {
      item1: 'Check out this {name}, {secondName}',
    };
    await softBracesCheck(testObject);
    assert(console.log.calledTwice);
  });

  it('Should log out two warning for two soft braces in two different strings', async () => {
    const testObject = {
      item1: 'Check out this {name}',
      item2: 'some other randoms string {abc}',
    };
    await softBracesCheck(testObject);
    assert(console.log.calledTwice);
  });

  it('Should log out one warning for for string with both types of braces ', async () => {
    const testObject = {
      item1: 'Check out this {name} and ${name} ',
    };
    await softBracesCheck(testObject);
    assert(console.log.calledOnce);
  });
});
