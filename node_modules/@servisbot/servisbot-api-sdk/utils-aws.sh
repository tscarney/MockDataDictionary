#!/usr/bin/env bash
set -e

if [[ ${DEBUG} == "True" ]]; then
  set -x
fi

###
# API Gateway
##
function update_api_gateway () {
    gateway_id=$(aws apigateway get-rest-apis --query "items[?contains(name, '${1}')].[id]" --output text)
    if [[ -n ${gateway_id} ]]; then
        aws apigateway create-deployment --rest-api-id ${gateway_id} --stage-name ${ENVIRONMENT}
    fi
}

function deploy_api_gateway () {
    drawbridge=(drawbridge scout forge gossip lynx oxford padlock botarmy-barracks botnet borg cog sbaas secrets-vault)

    if [[ " ${drawbridge[@]} " =~ " ${FUNCTION_NAME} " ]]; then
        echo "INFO: Deploying API Gateway"
        update_api_gateway drawbridge
    else
        echo "INFO: No API Gateway to deploy"
    fi
}

###
# Cloudwatch Metrics
##
function put_release_metrics () {
    echo
    #aws cloudwatch put-metric-data --namespace ${ENVIRONMENT}/releaseMetrics --metric-name ${FUNCTION_NAME} --unit Count --value 1
}

