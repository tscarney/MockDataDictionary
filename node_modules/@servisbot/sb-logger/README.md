# sb-logger
The ServisBOT logger (sb-logger) package is a light-weight logger
implementation that makes use of a defined logging format and supports
correlation IDs.

## Install

```bash
npm install --save @servisbot/sb-logger
```

## Using the logger

sb-logger can be used both as a global logger, such as:
```javascript
const Logger = require('@servisbot/sb-logger');
Logger.info('Hello, world');
```

Or it can be instantiated so that multiple loggers can co-exist with independent
configs:

```javascript
const Logger = require('@servisbot/sb-logger');
const logger = new Logger({ correlationId: 'abcdef', logLevel: 'debug' });
logger.info('Hello, world');
```

## Use Cases

### 1. Global Logger

When logging something at startup or in a scenario when a request is not being
processed (such as the heartbeat for lambda functions), it may be simpler to
make use of the logger without creating an instance:

```javascript
const Logger = require('@servisbot/sb-logger');
...
Logger.info('Heartbeat. Ceasing execution.'); // easy as pi
...
```

### 2. Logger Instances

"Why can't I just use the global logger all the time?" I hear you ask. This may
suit your use case perfectly, in which case use it that way all you want.
However, there are scenarios where multiple instances of the logger may be
required. Take for example the case of a lambda processing multiple SNS records
within the same invocation. Each record may have a different correlation ID and
the logging should not differ based on the number of records that the lambda
happened to receive at once.

The solution is to use instances of the logger for each record that is being
processed. This logger is then injected into the logic that will handle the
record. This allows each record to be logged independently of the others.
For example:

```javascript
const Logger = require('@servisbot/sb-logger');

// example only
event.Records.forEach(record => {
  main(new Logger({ correlationId: record.correlationId}), record);
});

```

## Log Levels and Formatting

sb-logger supports 4 levels of logs:

1. Error
2. Warn
3. Info
4. Debug

Each will print out the following:

```bash
ERROR - M81DUYPNBx - Hi from error
 WARN - M81DUYPNBx - Hi from warn
 INFO - M81DUYPNBx - Hi from info
DEBUG - M81DUYPNBx - Hi from debug
```

In the order of `[level] - [Correlation Id] -> [message]`.  

Multiple values can also be supplied to a log statement:

```javascript
const string = 'some string';
const object = { name : 'value'};
logger.info(string, object);
```

Will print the following to stdout:

```bash
INFO - hi73OTP34iG -> some string, {"name":"value"}
```

The log level being used by sb-logger can come from 3 places:

### 1. Passed on instantiation or using setter

The log level can be passed on instantiation of a logger or by calling the
setter at any time:

```javascript
const Logger = require('@servisbot/sb-logger');

// on instance
const logger = new Logger({ logLevel: 'debug' });
logger.setLogLevel('warn');

// on global
Logger.setLogLevel('error');
```

### 2. Set via Environment Variable

If the log level is not explicitly set for a logger instance or the global
logger, then the env var `LOG_LEVEL` will be checked for a valid log level.
If one is found then that is used. If `setLogLevel` is ever called then the
logger will use the now explicitly set level instead.

### 3. Default log level

If the log level is neither explicitly set or the `LOG_LEVEL` environment
variable is not set to a valid log level, then the logger will default to
`info`. This is true for both a logger instance and the global logger.

## Correlation ID

In sb-logger, the correlation ID is a string which is set on the logger and logged
with each statement. For the instantiated logger, the correlation ID can be
passed on instantiation or using the setter at any time. Example:

```javascript
const Logger = require('@servisbot/sb-logger');
const logger = new Logger({ correlationId: 'abcdef' });

// or at any time
logger.setCorrelationId('abcdef');
```

For the global logger, the correlation ID can be set at any time:

```javascript
const Logger = require('@servisbot/sb-logger');
Logger.setCorrelationId('abcdef');
```